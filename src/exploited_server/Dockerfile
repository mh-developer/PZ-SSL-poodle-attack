FROM nginx:1.21-alpine

RUN rm /etc/nginx/conf.d/default.conf
COPY nginx.conf /etc/nginx/conf.d/nginx.conf

EXPOSE 80 443

RUN apk update && \
    apk add --no-cache openssl && \
    openssl req -x509 -nodes -days 2000 \
    -subj  "/C=CA/ST=LA/O=CARE IZ OMARE INC/CN=care.si" \
    -newkey rsa:2048 -keyout "/etc/nginx/nginx-selfsigned.key" \
    -out "/etc/nginx/nginx-selfsigned.crt" && \
    chmod 766 "/etc/nginx/nginx-selfsigned.key" && \
    chmod 766 "/etc/nginx/nginx-selfsigned.crt";

CMD ["nginx", "-g", "daemon off;"]